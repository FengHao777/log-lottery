根据代码分析，点击"进入抽奖"按钮后会触发以下动画：

> **注意**：当前配置的卡片数量为 30 行 × 7 列 = 210 个卡片（可在 [`globalConfig.ts:10`](src/store/globalConfig.ts:10) 修改 `rowCount` 值调整）

## 进入抽奖动画流程

```mermaid
graph TD
    A[点击"进入抽奖"按钮] --> B[重置音频状态]
    B --> C[预加载音频资源]
    C --> D[启动随机卡片数据更新]
    D --> E[批量更新卡片背景色]
    E --> F[卡片从横铺布局变换为球体布局]
    F --> G[状态切换为准备就绪]
    G --> H[场景旋转0.1圈]
```

## 具体触发的动画

### 1. **重置音频状态** ([`useViewModel.ts:497`](src/views/Home/useViewModel.ts:497))
- **功能**：停止所有正在播放的音频
- **清理内容**：
  - 停止抽奖音乐
  - 清理所有正在播放的音频对象
  - 重置音频播放数组

### 2. **预加载音频资源** ([`useViewModel.ts:500-508`](src/views/Home/useViewModel.ts:500-508))
- **目的**：解决浏览器自动播放策略限制
- **实现方式**：检查 AudioContext 是否可用
- **兼容性**：支持标准 AudioContext 和 webkitAudioContext

### 3. **随机卡片数据更新动画** ([`useViewModel.ts:511`](src/views/Home/useViewModel.ts:511))
- **触发时机**：如果定时器不存在，则启动
- **更新频率**：每 500ms
- **更新数量**：每次随机更新 2 张卡片
- **效果**：卡片上的姓名、部门等信息会随机变化，营造抽奖氛围
- **实现方式**：使用 `setInterval` 定时器
- **优化措施**：
  - 使用 `requestAnimationFrame` 批量更新 DOM
  - 直接修改样式，避免重复调用 `useElementStyle`
  - 保持卡片大小和 GPU 加速属性

### 4. **批量更新卡片背景色** ([`useViewModel.ts:514-522`](src/views/Home/useViewModel.ts:514-522))
- **触发时机**：如果 patternList 有数据
- **实现方式**：使用 `requestAnimationFrame` 批量处理
- **更新范围**：前 `rowCount * 7` 个卡片
- **效果**：卡片背景色随机变化（透明度 0.25~0.75）
- **优化**：批量处理减少 DOM 操作次数

### 5. **Three.js 3D 卡片变换动画** ([`useViewModel.ts:524`](src/views/Home/useViewModel.ts:524))
- **动画类型**：Tween 补间动画
- **持续时间**：1000ms（1秒）
- **缓动函数**：`Exponential.InOut`
- **变换方向**：从横铺布局（`targets.table`）变换为球体布局（`targets.sphere`）
- **球体布局特点**：
  - 使用等面积分布算法（Equal Area Distribution）创建球体
  - 将球体按纬度划分为等面积的带状区域，然后在每个区域内均匀分布卡片
  - 所有卡片在球体上均匀分布，避免卡片聚集
  - 所有卡片朝向球心
  - **优势**：相比其他算法，等面积分布算法确保卡片在球体表面更加均匀，视觉效果更好
- **优化措施**：
  - **分批次执行**：每批次处理 10 个卡片，批次间隔 50ms
  - **减少同时运行的动画数量**：避免性能问题
  - **创建所有 Tween 对象但不立即启动**：先创建再分批启动
- **同时动画**：位置和旋转同时进行

### 6. **场景旋转动画** ([`useViewModel.ts:526`](src/views/Home/useViewModel.ts:526))
- **动画类型**：Tween 补间动画
- **旋转方向**：绕 Y 轴旋转
- **旋转角度**：0.1 圈（`Math.PI * 0.1 * 1000`）
- **持续时间**：2000ms（2秒）
- **效果**：场景缓慢旋转，增强 3D 效果

## 动画执行顺序

1. **第 0ms**：重置音频状态
2. **第 0-10ms**：预加载音频资源
3. **第 10ms**：启动随机卡片数据更新（每 500ms 一次）
4. **第 10-30ms**：批量更新卡片背景色
5. **第 30-1030ms**：卡片从横铺布局变换为球体布局（分批次执行）
6. **第 1030ms**：状态切换为 `LotteryStatus.ready`
7. **第 1030-3030ms**：场景旋转 0.1 圈
8. **持续运行**：随机卡片数据更新动画（每 500ms 一次）

## 性能优化

从代码中可以看到以下优化措施：

### 1. **分批次执行动画** ([`useViewModel.ts:210-252`](src/views/Home/useViewModel.ts:210-252))
- 每批次处理 10 个卡片
- 批次间隔 50ms
- 避免同时运行过多动画导致性能问题

### 2. **批量 DOM 操作** ([`useViewModel.ts:514-522`](src/views/Home/useViewModel.ts:514-522))
- 使用 `requestAnimationFrame` 批量更新卡片背景色
- 使用 `requestAnimationFrame` 批量更新卡片数据
- 减少 DOM 操作次数

### 3. **直接修改样式** ([`useViewModel.ts:798-850`](src/views/Home/useViewModel.ts:798-850))
- 避免重复调用 `useElementStyle`
- 直接修改元素的 style 属性
- 保持卡片大小和 GPU 加速属性

### 4. **降低更新频率** ([`useViewModel.ts:766`](src/views/Home/useViewModel.ts:766))
- 随机卡片更新频率从 200ms 提高到 500ms
- 每次更新的卡片数量从 4 个减少到 2 个

### 5. **预计算长度** ([`useViewModel.ts:773-774`](src/views/Home/useViewModel.ts:773-774))
- 预计算数组长度，避免在循环中重复计算
- 提高循环效率

### 6. **GPU 渲染优化** ([`useViewModel.ts:119-122`](src/views/Home/useViewModel.ts:119-122))
- **transform-style: preserve-3d**：保持 3D 变换，启用 GPU 加速
- **backface-visibility: hidden**：隐藏背面，减少渲染负担
- **perspective: 1000px**：设置透视效果，启用 GPU 加速
- **will-change: transform, opacity**：提示浏览器这些属性会变化，提前优化
- **contain: layout style paint**：限制重绘范围，提高渲染性能
- **transform: translateZ(0)**：触发 GPU 合成，提高渲染性能
- **优势**：这些 CSS 属性可以充分利用 GPU 加速，减少 CPU 负担，提高动画流畅度

## 用户体验

这些动画共同营造了一个流畅、动态的抽奖准备体验：

1. **视觉反馈**：卡片从横铺布局变换为球体布局，给用户明确的视觉提示
2. **氛围营造**：随机卡片数据更新和背景色变化，营造抽奖的紧张氛围
3. **3D 效果**：场景旋转增强 3D 效果，提升视觉冲击力
4. **流畅性**：分批次执行动画和批量 DOM 操作，保证动画流畅性
5. **状态明确**：状态切换为 `LotteryStatus.ready`，提示用户可以开始抽奖

## 后续操作

当动画完成后，用户可以：
- 点击"开始抽奖"按钮开始抽奖
- 按空格键（快捷键）开始抽奖
- 等待自动开始（如果设置了定时抽奖）
